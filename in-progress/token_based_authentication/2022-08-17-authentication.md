---
layout: post
title:
description: ''
date: '2022-08-17'
categories: token_based_authentication
note: 其實 what 的部分應該要真的有實作
mathjax:
mermaid:
p5:
threeJS:
anchor:
publish: true
---

## Introduction

TBC

## Why?

Token-based authentication and authorization mechanisms are used to enhance security, improve scalability, and enable efficient and stateless communication between the frontend and backend of web applications.

## How?

### JSON Web Tokens (JWT)

JWT (JSON Web Token) is a compact and self-contained token format that is widely used for secure data transmission and authentication in web applications and APIs. It provides a standardized structure for encoding claims, such as user identity and permissions, and can be easily verified and trusted by servers without the need for session state. For more information, please refer to [JWT]({{site.baseurl}}/token_based_authentication/2023/06/29/json-web-tokens.html)

### OAuth 2.0

OAuth 2.0 is an authorization framework that allows third-party applications to access protected resources on behalf of a user, using tokens for authentication and authorization.

OpenID Connect: OpenID Connect is an identity layer built on top of OAuth 2.0, providing a standardized way to authenticate users and obtain their identity information using ID tokens.

### SAML (Security Assertion Markup Language)

SAML is an XML-based framework for exchanging authentication and authorization data between identity providers and service providers, often used in single sign-on (SSO) scenarios.

### API Keys

API keys are unique tokens generated by the server and issued to clients for authentication and authorization in API requests, typically used in scenarios where full user authentication is not required.

### Token-based cookies

Cookies can be used as tokens to authenticate and authorize requests, where a server issues a cookie containing the necessary information for subsequent requests.


### Basic Authentication

Basic Authentication involves sending the API credentials (username and password) with every request. The credentials are encoded in Base64 and sent in the request headers. However, this method is not considered secure for APIs because the credentials are sent with every request and could be intercepted if the connection is not encrypted.

Given we have the [concept of HTTP]({{site.baseurl}}/internet/2021/04/09/http.html), client sent requests to server with key information in headers, including `Authorization` with form such as

```bash
Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==
```

`Basic` means the method of authentication and `QWxhZGRpbjpvcGVuIHNlc2FtZQ==` is encoded on client side and going to be decoded on server side to check authorization.

For example, given `username = Aladdin` and `password = open sesame`, the encoding of `Aladdin:open sesame` in Base64 is `YWxpY2U6c3VwZXJtYW4=` and client will send request with authorization in header:

```bash
Authorization: Basic YWxpY2U6c3VwZXJtYW4=
```

Then server will decode it in Base64 and match the `username` and `password` stored in server. If the result did not match, the example response:

```bash
HTTP/1.1 401 Unauthorized
Date: Wed, 21 Oct 2015 07:28:00 GMT
WWW-Authenticate: Basic realm="Access to staging site"
```

* pros
* cons
  * no session expiration mechanism, meaning once login, login in until browser cookie expires.
  * easy algorithm to hack
  * Replay attack (TBC)

### Token-Based Authentication

Token-based authentication involves exchanging credentials (username and password) for a token from the server. This token is then used to authenticate subsequent requests. Tokens can be stored on the client-side (e.g., local storage or cookies) and sent with each request in the headers. Tokens are typically long, randomly generated strings and can have an expiration time, providing better security.

### other

API Keys:
API keys are simple, unique strings that are used to authenticate requests. The API key is typically included in the request headers or as a query parameter. The server verifies the validity of the key before processing the request. API keys are easy to implement but provide a lower level of security as they can be compromised if not handled properly.

OAuth 2.0:
OAuth 2.0 is a widely adopted industry-standard protocol for authentication and authorization. It allows users to grant limited access to their resources on one website (called the "resource server") to another website or application (called the "client") without sharing their credentials. OAuth 2.0 involves obtaining an access token from the authorization server and using that token to make authenticated requests to the API.

## What?

### JWT in JS

```javascript
const jwt = require('jsonwebtoken');
const SECRET_KEY = 'secret_key';

// Generate a JWT
const token = jwt.sign({ id: 123, name: 'John Doe' }, SECRET_KEY, {
  expiresIn: '1h'
});

// Verify a JWT
const decoded = jwt.verify(token, SECRET_KEY);
console.log(decoded); // { id: 123, name: 'John Doe', iat: 1547451138, exp: 1547454738 }
```

* we can generate SECRET_KEY with `crypto`

```javascript
const crypto = require('crypto')
const key = crypto.randomBytes(32).toString('hex') // secret key
```

## Reference

[開發者必備知識 - HTTP認證（HTTP Authentication）](https://carsonwah.github.io/http-authentication.html)
